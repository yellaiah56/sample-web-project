pipeline {
    agent any
tools{
     maven 'maven3.8.6' 
  }
  
    stages {
        stage('checke out code'){
        steps{
        git branch: 'test', url: 'https://github.com/yellaiah56/sample-web-project.git'
        }
      }
        stage('build'){
        steps{
        sh 'mvn clean package'
        }
        }
        stage("build image"){
        when {
         expression{
            return env.GIT_BRANCH == "origin/master"
                   }
            }
            steps{
                sh 'docker build -t yellaiah56/webproject:1 . '
            }
        }
        stage('docker image verify'){
        steps{
        sh 'docker images'
        }
        }
        stage('docker login'){
        steps{
        withCredentials([string(credentialsId: 'dockerhub_password', variable: 'password')]) {
    sh 'docker login -u yellaiah56 -p $password'
}
        }
        }
        stage('docker image push'){
        steps{
        sh 'docker push yellaiah56/webproject:1'
        }
        }
        
    }
}
